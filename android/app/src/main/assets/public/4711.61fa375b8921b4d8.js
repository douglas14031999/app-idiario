"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4711],{4711:(C,p,u)=>{u.r(p),u.d(p,{Tab1PageModule:()=>x});var g=u(177),h=u(9417),d=u(4742),f=u(7500),_=u(467),e=u(4438),v=u(2064),F=u(1795),b=u(3205),D=u(8150),T=u(7291);function I(n,o){1&n&&(e.j41(0,"div",9)(1,"p"),e.EFF(2,"Nenhuma frequ\xeancia encontrada."),e.k0s()())}function P(n,o){if(1&n&&(e.j41(0,"div")(1,"h3",11),e.EFF(2),e.k0s(),e.j41(3,"div",12)(4,"p"),e.EFF(5,"Ainda n\xe3o h\xe1 nenhuma chamada hoje."),e.k0s()()()),2&n){const t=e.XpG().$implicit;e.R7$(2),e.JRh(t.format_date)}}function q(n,o){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.Lme(" ",t.disciplineName," - ",t.classroomName," ")}}function $(n,o){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.classroomName," ")}}function j(n,o){if(1&n){const t=e.RV6();e.j41(0,"ion-item",2),e.bIt("click",function(){const s=e.eBV(t).$implicit,r=e.XpG().$implicit,l=e.XpG(2).$implicit,a=e.XpG(2);return e.Njj(a.editFrequency(r.id,s.classroomId,l.date,s.disciplineId,s.classNumbers))}),e.j41(1,"ion-label",18),e.DNE(2,q,2,2,"span",7)(3,$,2,1,"span",7),e.k0s()()}if(2&n){const t=o.$implicit;e.R7$(2),e.Y8G("ngIf",t.disciplineId),e.R7$(),e.Y8G("ngIf",!t.disciplineId)}}function E(n,o){if(1&n&&(e.j41(0,"ion-accordion",14)(1,"ion-item",15)(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"div",16),e.DNE(5,j,4,2,"ion-item",17),e.k0s()()),2&n){const t=o.$implicit;e.R7$(3),e.JRh(t.name),e.R7$(2),e.Y8G("ngForOf",t.classroomDisciplines)}}function R(n,o){if(1&n&&(e.j41(0,"div")(1,"h3",11),e.EFF(2),e.k0s(),e.j41(3,"ion-accordion-group"),e.DNE(4,E,6,2,"ion-accordion",13),e.k0s()()),2&n){const t=e.XpG().$implicit;e.R7$(2),e.JRh(t.format_date),e.R7$(2),e.Y8G("ngForOf",t.unities)}}function N(n,o){if(1&n&&(e.j41(0,"div"),e.DNE(1,P,6,1,"div",7)(2,R,5,2,"div",7),e.k0s()),2&n){const t=o.$implicit,i=o.index;e.R7$(),e.Y8G("ngIf",0===i&&!t.exists),e.R7$(),e.Y8G("ngIf",t.exists)}}function G(n,o){if(1&n&&(e.j41(0,"div"),e.DNE(1,N,3,2,"div",10),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.lastFrequencyDays)}}const S=[{path:"",component:(()=>{var n;class o{constructor(i,s,r,l,a,c,m,y){this.router=i,this.sync=s,this.loadingCtrl=r,this.dailyFrequencyService=l,this.auth=a,this.utilsService=c,this.storage=m,this.route=y,this.lastFrequencyDays=[],this.currentDate=new Date}ngOnInit(){var i=this;return(0,_.A)(function*(){yield i.sync.isSyncDelayed(),i.route.params.subscribe((0,_.A)(function*(){yield i.refreshLastFrequencyDays()}))})()}refreshLastFrequencyDays(){var i=this;return(0,_.A)(function*(){i.currentDate=new Date,i.lastFrequencyDays=[],yield i.loadMoreFrequencies()})()}newFrequency(){var i=this;return(0,_.A)(function*(){yield i.router.navigate(["/frequency"])})()}lastTenFrequencies(i){const s=[];for(let l=10;l>0;l--){const a=this.utilsService.toStringWithoutTime(this.currentDate),c=this.frequenciesOfDay(i,a);s.push({date:a,format_date:this.utilsService.toExtensiveFormat(this.currentDate),exists:c.length>0,unities:this.unitiesOfFrequency(c)}),this.currentDate.setDate(this.currentDate.getDate()-1)}return s}frequenciesOfDay(i,s){return i.filter(r=>r.frequency_date===s)}unitiesOfFrequency(i){if(!i)return[];const s=[];return i.forEach(r=>{-1===s.findIndex(l=>l.id==r.unity_id)&&s.push({id:r.unity_id,name:r.unity_name,classroomDisciplines:this.classroomDisciplinesOfUnityFrequency(i,r.unity_id)})}),s}classroomDisciplinesOfUnityFrequency(i,s){const r=i.filter(a=>a.unity_id==s),l=[];return r.forEach(a=>{const c=l.findIndex(m=>m.classroomId==a.classroom_id&&m.disciplineId==a.discipline_id);c<0?l.push({classroomId:a.classroom_id,classroomName:a.classroom_name,disciplineId:a.discipline_id,disciplineName:a.discipline_name,classNumbers:a.class_number?[a.class_number]:[]}):a.class_number&&l[c].classNumbers.push(a.class_number)}),l.sort((a,c)=>{const m=this.utilsService.comparableString(a.classroomName+a.disciplineName),y=this.utilsService.comparableString(c.classroomName+c.disciplineName);return m>y?1:y>m?-1:0})}loadMoreFrequencies(){var i=this;return(0,_.A)(function*(){i.loadingSync=yield i.loadingCtrl.create({message:"Carregando..."}),yield i.loadingSync.present();const s=yield i.storage.get("frequencies");if(s){const r=i.lastFrequencyDays.length;let l=0;for(;r>=i.lastFrequencyDays.length&&l<10;){const a=i.lastTenFrequencies(s.daily_frequencies).filter(c=>c.exists);i.lastFrequencyDays=i.lastFrequencyDays.concat(a),l+=1}}yield i.loadingSync.dismiss()})()}editFrequency(i,s,r,l,a){var c=this;return(0,_.A)(function*(){const m=!l;c.loadingSync=yield c.loadingCtrl.create({message:"Carregando..."}),yield c.loadingSync.present(),c.auth.currentUser().subscribe(y=>{c.dailyFrequencyService.getStudents({userId:y.id,teacherId:y.teacher_id,unityId:i,classroomId:s,frequencyDate:r,disciplineId:l,classNumbers:a?a.join():""}).subscribe({next:X=>{c.router.navigate(["/students-frequency-edit"],{queryParams:{global:m},state:{result:X}})},complete:()=>c.loadingSync.dismiss()})})})()}doRefresh(){var s,i=this;this.sync.execute().subscribe({next:(s=(0,_.A)(function*(){return yield i.refreshLastFrequencyDays()}),function(){return s.apply(this,arguments)})})}}return(n=o).\u0275fac=function(i){return new(i||n)(e.rXU(f.Ix),e.rXU(v.n),e.rXU(d.Xi),e.rXU(F.P),e.rXU(b.u),e.rXU(D.T),e.rXU(T.n),e.rXU(f.nX))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-tab1"]],decls:15,vars:2,consts:[["mode","md"],["slot","end"],[3,"click"],["slot","icon-only","name","sync"],["slot","icon-only","name","add"],[1,"page-content"],["class","empty-results",4,"ngIf"],[4,"ngIf"],[1,"load-more"],[1,"empty-results"],[4,"ngFor","ngForOf"],[1,"date-header"],[1,"empty-results",2,"margin","0"],["class","panel",4,"ngFor","ngForOf"],[1,"panel"],["slot","header"],["slot","content"],[3,"click",4,"ngFor","ngForOf"],[1,"view-eye"]],template:function(i,s){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"Frequ\xeancia"),e.k0s(),e.j41(4,"ion-buttons",1)(5,"ion-button",2),e.bIt("click",function(){return s.doRefresh()}),e.nrm(6,"ion-icon",3),e.k0s(),e.j41(7,"ion-button",2),e.bIt("click",function(){return s.newFrequency()}),e.nrm(8,"ion-icon",4),e.k0s()()()(),e.j41(9,"ion-content",5),e.DNE(10,I,3,0,"div",6)(11,G,2,1,"div",7),e.j41(12,"div",8)(13,"ion-button",2),e.bIt("click",function(){return s.loadMoreFrequencies()}),e.EFF(14," Carregar mais frequ\xeancias "),e.k0s()()()),2&i&&(e.R7$(10),e.Y8G("ngIf",0===s.lastFrequencyDays.length),e.R7$(),e.Y8G("ngIf",s.lastFrequencyDays.length))},dependencies:[d.xk,d.YH,d.Jm,d.QW,d.W9,d.eU,d.iq,d.uz,d.he,d.BC,d.ai,g.Sq,g.bT]}),o})()}];let k=(()=>{var n;class o{}return(n=o).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[f.iI.forChild(S),f.iI]}),o})(),x=(()=>{var n;class o{}return(n=o).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[d.bv,g.MD,h.YN,k]}),o})()}}]);