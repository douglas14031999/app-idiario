"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4738],{4738:(K,C,a)=>{a.r(C),a.d(C,{FrequencyPageModule:()=>z});var p=a(177),u=a(9417),c=a(4742),y=a(7500),v=a(467),j=a(3656),I=a(8141),b=a(9437),q=a(7673),S=a(980),e=a(4438),R=a(1659),P=a(3205),T=a(1795),x=a(2924),M=a(7528),G=a(9427),X=a(8150),E=a(8035),D=a(7291);function $(t,r){if(1&t&&(e.j41(0,"ion-item")(1,"ion-radio",20),e.EFF(2),e.k0s()()),2&t){const i=r.$implicit;e.R7$(),e.FS9("value",i.id),e.BMQ("aria-label",i.description),e.R7$(),e.SpI(" ",i.description," ")}}function B(t,r){if(1&t){const i=e.RV6();e.j41(0,"div",15)(1,"h3",16),e.EFF(2,"Qual a escola?"),e.k0s(),e.j41(3,"ion-list",17)(4,"ion-radio-group",18),e.mxI("ngModelChange",function(n){e.eBV(i);const o=e.XpG();return e.DH7(o.unityId,n)||(o.unityId=n),e.Njj(n)}),e.bIt("ionChange",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.onChangeUnity())}),e.DNE(5,$,3,3,"ion-item",19),e.k0s()()()}if(2&t){const i=e.XpG();e.R7$(4),e.R50("ngModel",i.unityId),e.R7$(),e.Y8G("ngForOf",i.unities)}}function V(t,r){1&t&&(e.j41(0,"div",21)(1,"p"),e.EFF(2,"Nenhuma escola encontrada."),e.k0s()())}function N(t,r){if(1&t&&(e.j41(0,"ion-item")(1,"ion-radio",20),e.EFF(2),e.k0s()()),2&t){const i=r.$implicit;e.R7$(),e.FS9("value",i.id),e.BMQ("aria-label",i.description),e.R7$(),e.SpI(" ",i.description," ")}}function O(t,r){if(1&t){const i=e.RV6();e.j41(0,"div",22)(1,"h3",16),e.EFF(2,"Turma"),e.k0s(),e.j41(3,"ion-list",17)(4,"ion-radio-group",23),e.mxI("ngModelChange",function(n){e.eBV(i);const o=e.XpG();return e.DH7(o.classroomId,n)||(o.classroomId=n),e.Njj(n)}),e.bIt("ionChange",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.onChangeClassroom())}),e.DNE(5,N,3,3,"ion-item",19),e.k0s()()()}if(2&t){const i=e.XpG();e.R7$(4),e.R50("ngModel",i.classroomId),e.R7$(),e.Y8G("ngForOf",i.classrooms)}}function U(t,r){if(1&t&&(e.j41(0,"ion-item")(1,"ion-radio",20),e.EFF(2),e.k0s()()),2&t){const i=r.$implicit;e.R7$(),e.FS9("value",i.id),e.BMQ("aria-label",i.description),e.R7$(),e.SpI(" ",i.description," ")}}function A(t,r){if(1&t){const i=e.RV6();e.j41(0,"div",24)(1,"h3",16),e.EFF(2,"Disciplina"),e.k0s(),e.j41(3,"ion-list",17)(4,"ion-radio-group",25),e.mxI("ngModelChange",function(n){e.eBV(i);const o=e.XpG();return e.DH7(o.disciplineId,n)||(o.disciplineId=n),e.Njj(n)}),e.DNE(5,U,3,3,"ion-item",19),e.k0s()()()}if(2&t){const i=e.XpG();e.R7$(4),e.R50("ngModel",i.disciplineId),e.R7$(),e.Y8G("ngForOf",i.disciplines)}}function Y(t,r){if(1&t){const i=e.RV6();e.j41(0,"ion-item",29)(1,"ion-checkbox",30),e.bIt("ionChange",function(){const n=e.eBV(i).$implicit,o=e.XpG(2);return e.Njj(o.updateSelectedClasses(n))}),e.EFF(2),e.k0s()()}if(2&t){const i=r.$implicit,s=e.XpG(2);e.R7$(),e.Y8G("checked",s.selectedClasses.indexOf(i)>-1),e.R7$(),e.SpI(" ",i,"\xaa ")}}function k(t,r){if(1&t&&(e.j41(0,"div",26)(1,"h3",16),e.EFF(2,"Aulas"),e.k0s(),e.j41(3,"ion-list",27),e.DNE(4,Y,3,2,"ion-item",28),e.k0s()()),2&t){const i=e.XpG();e.R7$(4),e.Y8G("ngForOf",i.classes)}}function W(t,r){if(1&t){const i=e.RV6();e.j41(0,"div")(1,"h3",16),e.EFF(2,"Data"),e.k0s(),e.j41(3,"ion-datetime",31),e.mxI("ngModelChange",function(n){e.eBV(i);const o=e.XpG();return e.DH7(o.date,n)||(o.date=n),e.Njj(n)}),e.k0s()()}if(2&t){const i=e.XpG();e.R7$(3),e.R50("ngModel",i.date),e.Y8G("max",i.currentDate.toISOString())}}function Q(t,r){if(1&t&&(e.j41(0,"ion-button",32),e.EFF(1," Carregar lista de frequ\xeancia "),e.k0s()),2&t){const i=e.XpG(),s=e.sdS(9);e.Y8G("disabled",!s.valid||!i.classrooms.length||!i.globalAbsence&&!i.selectedClasses.length)}}const H=[{path:"",component:(()=>{var t;class r{constructor(s,n,o,l,d,g,F,m,h,f,_,J){this.classroomsService=s,this.auth=n,this.loadingCtrl=o,this.dailyFrequencyService=l,this.examRulesService=d,this.disciplinesService=g,this.schoolCalendarsService=F,this.utilsService=m,this.cdr=h,this.messages=f,this.storage=_,this.router=J,this.unities=[],this.classrooms=[],this.currentDate=new Date,this.globalAbsence=!0,this.selectedClasses=[]}ngOnInit(){var s=this;return(0,v.A)(function*(){if(!s.date){const n=s.utilsService.getCurrentDate();s.date=s.utilsService.toStringWithoutTime(n)}(!s.unities||!s.unities.length)&&(s.unities=yield s.storage.get("unities"))})()}ionViewWillLeave(){this.utilsService.leaveView(!0)}scrollTo(s){document.getElementById(s)}onChangeUnity(){this.unityId&&this.showLoader("Carregando...").then(s=>{this.auth.currentUser().subscribe(n=>{this.classroomsService.getOfflineClassrooms(this.unityId).subscribe({next:o=>{this.schoolCalendarsService.getOfflineSchoolCalendar(this.unityId).subscribe({next:l=>{this.resetSelectedValues(),this.classrooms=o.data||[],s.dismiss(),l.data?(this.classes=this.schoolCalendarsService.getClasses(l.data.number_of_classes),this.cdr.detectChanges(),this.scrollTo("frequency-classroom")):this.messages.showToast("Calend\xe1rio escolar n\xe3o encontrado.")},error:l=>{this.resetOptions(),s.dismiss(),this.messages.showToast(l)}})},error:o=>{this.resetOptions(),s.dismiss(),this.messages.showToast(o)}})})})}onChangeClassroom(){var s=this;return(0,v.A)(function*(){if(!s.classroomId)return;const n=Number(s.classroomId);s.disciplineId=void 0;let o=s.classes;s.classes=[],s.selectedClasses=[],s.cdr.detectChanges(),s.classes=o;const l=yield s.loadingCtrl.create({message:"Carregando..."});yield l.present(),s.examRulesService.getOfflineExamRules(n).pipe((0,I.M)(d=>{d.data.exam_rule&&d.data.exam_rule.allow_frequency_by_discipline?s.disciplinesService.getOfflineDisciplines(n).pipe((0,I.M)(g=>{s.disciplines=g.data,s.globalAbsence=!1,s.cdr.detectChanges(),s.scrollTo("frequency-discipline")}),(0,b.W)(g=>(console.log(g),(0,q.of)(null))),(0,S.j)(()=>l.dismiss())).subscribe():(s.globalAbsence=!0,s.cdr.detectChanges(),s.scrollTo("frequency-date"),l.dismiss())}),(0,b.W)(d=>(console.log(d),(0,q.of)(null)))).subscribe()})()}onChangeDiscipline(){this.scrollTo("frequency-classes")}frequencyForm(s){const n=s.value.unity,o=s.value.classroom,l=this.utilsService.dateToTimezone(s.value.date),d=this.utilsService.toStringWithoutTime(l),g=s.value.discipline,F=this.selectedClasses||[];this.showLoader("Carregando...").then(m=>{this.auth.currentUser().subscribe(h=>{this.dailyFrequencyService.getStudents({userId:h.id,teacherId:h.teacher_id,unityId:n,classroomId:o,frequencyDate:d,disciplineId:g,classNumbers:F.join()}).subscribe({next:f=>{this.router.navigate(["/students-frequency-edit"],{queryParams:{global:this.globalAbsence},state:{result:f}}),m.dismiss()},error:f=>{m.dismiss()}})})})}resetSelectedValues(){this.globalAbsence=!0,this.classroomId=void 0,this.disciplineId=void 0,this.selectedClasses=[]}resetOptions(){this.classrooms=[],this.disciplines=[],this.classes=[],this.resetSelectedValues()}updateSelectedClasses(s){const n=this.selectedClasses.indexOf(s);n<0?this.selectedClasses.push(s):this.selectedClasses.splice(n,1)}goBack(){this.router.navigate(["/tabs/tab1"])}showLoader(s){var n=this;return(0,v.A)(function*(){const o=yield n.loadingCtrl.create({message:s});return yield o.present(),o})()}}return(t=r).\u0275fac=function(s){return new(s||t)(e.rXU(R.y),e.rXU(P.u),e.rXU(c.Xi),e.rXU(T.P),e.rXU(x._),e.rXU(M.F),e.rXU(G.D),e.rXU(X.T),e.rXU(e.gRc),e.rXU(E.G),e.rXU(D.n),e.rXU(y.Ix))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-frequency"]],viewQuery:function(s,n){if(1&s&&e.GBs(c.W9,5),2&s){let o;e.mGM(o=e.lsd())&&(n.content=o.first)}},features:[e.Jv_([j.y8])],decls:19,vars:7,consts:[["f","ngForm"],["slot","end"],[3,"click"],["slot","icon-only","name","close"],["id","frequency-page",1,"page-content"],[3,"ngSubmit"],[1,"form-frequency"],["class","form-item",4,"ngIf"],["class","empty-results",4,"ngIf"],["class","form-item","id","frequency-classroom",4,"ngIf"],["class","form-item","id","frequency-discipline",4,"ngIf"],["class","form-item","id","frequency-classes",4,"ngIf"],[4,"ngIf"],[1,"container-button-frequency"],["type","submit",3,"disabled",4,"ngIf"],[1,"form-item"],[1,"form-item-title"],[1,"panel"],["name","unity","required","",3,"ngModelChange","ionChange","ngModel"],[4,"ngFor","ngForOf"],[3,"value"],[1,"empty-results"],["id","frequency-classroom",1,"form-item"],["name","classroom","required","",3,"ngModelChange","ionChange","ngModel"],["id","frequency-discipline",1,"form-item"],["name","discipline","required","",3,"ngModelChange","ngModel"],["id","frequency-classes",1,"form-item"],[1,"itens-checkbox","panel"],["class","form-item-check-item",4,"ngFor","ngForOf"],[1,"form-item-check-item"],[3,"ionChange","checked"],["name","date","locale","pt-BR","presentation","date",1,"panel",3,"ngModelChange","ngModel","max"],["type","submit",3,"disabled"]],template:function(s,n){if(1&s){const o=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Nova frequ\xeancia"),e.k0s(),e.j41(4,"ion-buttons",1)(5,"ion-button",2),e.bIt("click",function(){return e.eBV(o),e.Njj(n.goBack())}),e.nrm(6,"ion-icon",3),e.k0s()()()(),e.j41(7,"ion-content",4)(8,"form",5,0),e.bIt("ngSubmit",function(){e.eBV(o);const d=e.sdS(9);return e.Njj(n.frequencyForm(d))}),e.j41(10,"div",6),e.DNE(11,B,6,2,"div",7)(12,V,3,0,"div",8)(13,O,6,2,"div",9)(14,A,6,2,"div",10)(15,k,5,1,"div",11)(16,W,4,2,"div",12),e.j41(17,"div",13),e.DNE(18,Q,2,1,"ion-button",14),e.k0s()()()()}2&s&&(e.R7$(11),e.Y8G("ngIf",n.unities.length),e.R7$(),e.Y8G("ngIf",!n.unities.length),e.R7$(),e.Y8G("ngIf",n.classrooms.length>0),e.R7$(),e.Y8G("ngIf",!n.globalAbsence),e.R7$(),e.Y8G("ngIf",!n.globalAbsence),e.R7$(),e.Y8G("ngIf",n.classrooms.length),e.R7$(2),e.Y8G("ngIf",n.unities.length))},dependencies:[p.Sq,p.bT,u.qT,u.BC,u.cb,u.YS,u.vS,u.cV,c.Jm,c.QW,c.eY,c.W9,c.A9,c.eU,c.iq,c.uz,c.nf,c.KO,c.f0,c.BC,c.ai,c.hB,c.Je],styles:[".container-button-frequency[_ngcontent-%COMP%]{margin-top:15px;text-align:center;padding-bottom:calc(15px + env(safe-area-inset-bottom))}"]}),r})()}];let L=(()=>{var t;class r{}return(t=r).\u0275fac=function(s){return new(s||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[y.iI.forChild(H),y.iI]}),r})(),z=(()=>{var t;class r{}return(t=r).\u0275fac=function(s){return new(s||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[p.MD,u.YN,c.bv,L]}),r})()}}]);