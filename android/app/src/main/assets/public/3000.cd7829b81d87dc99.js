"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3e3],{3e3:(k,f,r)=>{r.r(f),r.d(f,{ContentRecordFormPageModule:()=>_});var C=r(177),u=r(9417),c=r(4742),g=r(7500),p=r(467),R=r(7468),n=r(4438),P=r(7291),F=r(8150),M=r(5915);function v(o,a){if(1&o){const d=n.RV6();n.j41(0,"ion-item")(1,"ion-checkbox",10),n.mxI("ngModelChange",function(t){const i=n.eBV(d).$implicit;return n.DH7(i.checked,t)||(i.checked=t),n.Njj(t)}),n.EFF(2),n.k0s()()}if(2&o){const d=a.$implicit;n.R7$(),n.R50("ngModel",d.checked),n.R7$(),n.SpI(" ",d.description," ")}}const y=[{path:"",component:(()=>{var o;class a{constructor(e,t,i,s,l){this.storage=e,this.utilsService=t,this.contentRecordService=i,this.route=s,this.router=l,this.newContent="",this.baseContents={},this.contentRecord={},this.contents=[]}ngOnInit(){this.route.queryParams.subscribe(e=>{this.baseContents={},this.contentRecord={},this.contents=[],this.recordDate=e.date;const t=this.utilsService.getDate(this.recordDate);t.setHours(24,0,0,0),this.displayDate=this.utilsService.toExtensiveFormat(t),this.unityId=e.unityId,this.disciplineId=e.disciplineId,this.classroomId=e.classroomId,this.gradeId=e.gradeId,this.description=e.description,this.callback=e.callback,this.classroomName=e.classroomName,this.unityName=e.unityName,(0,R.p)({contentLessonPlans:this.storage.get("contentLessonPlans"),contentRecords:this.storage.get("contentRecords"),teachingPlans:this.storage.get("teachingPlans")}).subscribe(i=>{const l=i.contentRecords||[],h=i.teachingPlans||[];this.baseContents=this.getContentLessonPlan(i.contentLessonPlans||[]),this.baseContents||(this.baseContents=this.getTeachingPlan(h)),this.contentRecord=this.getContentRecord(l),this.contentRecord||(this.contentRecord={id:void 0,record_date:this.recordDate,classroom_id:this.classroomId,classroom_name:this.classroomName,description:this.description,discipline_id:this.disciplineId,grade_id:this.gradeId,unity_id:this.unityId,unity_name:this.unityName,contents:[]}),this.loadContents()})})}ionViewWillLeave(){var e=this;return(0,p.A)(function*(){const t=e.contentRecord.contents.map(s=>s.description.trim()).sort(),i=e.contents.filter(s=>s.checked).map(s=>s.description.trim()).sort();JSON.stringify(t)!==JSON.stringify(i)&&(e.contentRecord.contents=e.contents.filter(s=>s.checked),e.contentRecordService.createOrUpdate(e.contentRecord).subscribe(()=>{"function"==typeof e.callback&&e.callback()}))})()}loadContents(){var e,t;const i=(null===(e=this.baseContents)||void 0===e?void 0:e.contents)||[],s=(null===(t=this.contentRecord)||void 0===t?void 0:t.contents)||[];this.contents=i.concat(s).filter((l,h,m)=>m.findIndex(b=>b.description===l.description)===h),(this.contentRecord.contents||[]).forEach(l=>{const h=this.contents.map(m=>m.description).indexOf(l.description);h>=0&&(this.contents[h].checked=!0)})}addContent(){const e=this.contents.findIndex(t=>this.utilsService.compareStrings(t.description,this.newContent));return e>=0?this.contents[e].checked=!0:this.contents.push({id:void 0,description:this.newContent,checked:!0}),this.newContent="",!1}getContentLessonPlan(e){return e.flatMap(t=>t.lesson_plans).find(t=>{if(t.grade_id==this.gradeId&&t.classroom_id==this.classroomId&&t.discipline_id==this.disciplineId&&t.unity_id==this.unityId&&t.start_at<=this.recordDate&&t.end_at>=this.recordDate)return t})}getContentRecord(e){return e.find(t=>{if(t.grade_id==this.gradeId&&t.classroom_id==this.classroomId&&t.discipline_id==this.disciplineId&&t.unity_id==this.unityId&&t.record_date==this.recordDate)return t})}getTeachingPlan(e){return e.flatMap(t=>t.unities).filter(t=>t.unity_id==this.unityId).flatMap(t=>t.plans).find(t=>{if(t.grade_id==this.gradeId&&t.discipline_id==this.disciplineId)return t})}goBack(){var e=this;(0,R.p)({contentRecords:this.storage.get("contentRecords")}).subscribe(function(){var t=(0,p.A)(function*(i){yield e.contentRecordService.updateContentRecords(e.contentRecordService.addOrReplaceContentRecord(i.contentRecords,e.contentRecord)),yield e.router.navigate(["/tabs/tab2"])});return function(i){return t.apply(this,arguments)}}())}}return(o=a).\u0275fac=function(e){return new(e||o)(n.rXU(P.n),n.rXU(F.T),n.rXU(M.H),n.rXU(g.nX),n.rXU(g.Ix))},o.\u0275cmp=n.VBU({type:o,selectors:[["app-content-record-form"]],decls:17,vars:7,consts:[["mode","md"],["slot","start"],["defaultHref","/",3,"click"],[1,"title-content-record"],[1,"content-record-unity-name"],[1,"page-content",3,"fullscreen"],[1,"details-panel"],[1,"content-record-description"],[4,"ngFor","ngForOf"],["name","newContent","placeholder","Adicionar novo conte\xfado...",3,"ngModelChange","change","ngModel"],[3,"ngModelChange","ngModel"]],template:function(e,t){1&e&&(n.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-back-button",2),n.bIt("click",function(){return t.goBack()}),n.k0s()(),n.j41(4,"ion-title")(5,"p",3),n.EFF(6),n.k0s(),n.j41(7,"p",4),n.EFF(8),n.k0s()()()(),n.j41(9,"ion-content",5)(10,"div",6)(11,"p",7),n.EFF(12),n.k0s(),n.j41(13,"ion-list"),n.DNE(14,v,3,2,"ion-item",8),n.j41(15,"ion-item")(16,"ion-input",9),n.mxI("ngModelChange",function(s){return n.DH7(t.newContent,s)||(t.newContent=s),s}),n.bIt("change",function(){return t.addContent()}),n.k0s()()()()()),2&e&&(n.R7$(6),n.JRh(t.displayDate),n.R7$(2),n.JRh(t.contentRecord.unity_name),n.R7$(),n.Y8G("fullscreen",!0),n.R7$(3),n.Lme(" ",t.contentRecord.description," - ",t.contentRecord.classroom_name," "),n.R7$(2),n.Y8G("ngForOf",t.contents),n.R7$(2),n.R50("ngModel",t.newContent))},dependencies:[C.Sq,u.BC,u.vS,c.QW,c.eY,c.W9,c.eU,c.$w,c.uz,c.nf,c.BC,c.ai,c.hB,c.Gw,c.el],styles:[".title-content-record[_ngcontent-%COMP%]{font-size:24px;color:#fff;margin:0}.content-record-unity-name[_ngcontent-%COMP%]{font-size:14px;color:#fff;margin:6px 0}.content-record-description[_ngcontent-%COMP%]{margin-left:10px;font-size:16px}.page-content[_ngcontent-%COMP%]{--padding-bottom: calc(15px + env(safe-area-inset-bottom)) }#content-record-form[_ngcontent-%COMP%]   .item-inner[_ngcontent-%COMP%]{border-bottom:0}#content-record-form[_ngcontent-%COMP%]   ion-item.item-input[_ngcontent-%COMP%]{border-bottom:0}#content-record-form[_ngcontent-%COMP%]   ion-item.item-input.input-has-focus[_ngcontent-%COMP%]:last-child{box-shadow:none}#content-record-form[_ngcontent-%COMP%]   .item.item-md[_ngcontent-%COMP%]   .checkbox-md[_ngcontent-%COMP%]{margin:9px 15px 9px 4px}"]}),a})()}];let I=(()=>{var o;class a{}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.$C({type:o}),o.\u0275inj=n.G2t({imports:[g.iI.forChild(y),g.iI]}),a})(),_=(()=>{var o;class a{}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.$C({type:o}),o.\u0275inj=n.G2t({imports:[C.MD,u.YN,c.bv,I]}),a})()}}]);